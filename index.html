<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>ููุตุฉ ุฒุฏ ุฅููุงูู โ ุชุทุจูู ุชุฃูููู ุชูุงุนูู</title>
<meta name="description" content="ููุตูุฉ ูุงุฏุฆุฉ ูุชุนุฒูุฒ ุงูุฅููุงู ุนุจุฑ ุงูุฃุณูุงุก ุงูุญุณููุ ุฑุจุท ุงูุชูุฏูู ุจุณูููู ูุงูููุฒ ููุฑู ูุงุณููุ ูุจูุงุก ุฎุทุฉ 14 ููููุง ูุฏุนููุฉ ุจุขูุงุช ูุชูุงุฑูู ููุณูุฉ."/>
<meta name="theme-color" content="#0f6781"/>
<link id="manifestLink" rel="manifest"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
<meta property="og:title" content="ููุตุฉ ุฒุฏ ุฅููุงูู"/>
<meta property="og:description" content="ูููู ุฅููุงููุ ุงูุชุดู ูุณุชูู ูุนููุ ูุงุจูู ุฎุทุฉ 14 ููููุง"/>
<meta property="og:type" content="website"/>
<meta name="twitter:card" content="summary"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
<style>
:root{--blue:#0f6781;--blue2:#2a7c92;--beige:#efe9dc;--gold:#d4a944;--ink:#0f1a20;--muted:#5c6a7a;--card:#ffffff;--border:#e6ecf2;--badge:#f7fafc;--bg:#ffffff;--bg2:#f7f5ef}
@media (prefers-color-scheme: dark){:root{--bg:#0b1216;--bg2:#0e161b;--card:#101a20;--ink:#e9eef2;--muted:#a7b3bf;--border:#1f2a33;--badge:#0f1a21}}
*{box-sizing:border-box}html,body{margin:0;height:100%}
body{font-family:system-ui,-apple-system,"Tajawal","Noto Kufi Arabic",Segoe UI,Roboto,sans-serif;color:var(--ink);background:
radial-gradient(1200px 400px at 90% -10%, rgba(212,169,68,.10), transparent),
radial-gradient(900px 500px at 10% -20%, rgba(15,103,129,.12), transparent),
linear-gradient(180deg,var(--bg2) 0%,var(--bg) 60%,var(--bg2) 100%);}
.container{max-width:1200px;margin:0 auto;padding:14px}a{color:inherit;text-decoration:none}
:focus-visible{outline:2px solid var(--gold);outline-offset:2px}

/* Skip link */
.skip a{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
.skip a:focus{left:12px;top:12px;width:auto;height:auto;background:#fff;padding:8px 12px;border-radius:10px;border:1px solid var(--border);z-index:1000}

/* Header */
.header{position:sticky;top:0;z-index:40;backdrop-filter:blur(10px);background:rgba(255,255,255,.75);border-bottom:1px solid var(--border)}
@media (prefers-color-scheme: dark){.header{background:rgba(16,26,32,.6)}}
.header-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0}
/* RIGHT: brand + nav */
.brand{display:flex;align-items:center;gap:12px;min-width:0}
.app-logo-wrap{display:flex;flex-direction:column;align-items:center;gap:4px}
.app-logo{width:56px;height:56px;border-radius:14px;background:var(--badge);border:1px solid var(--border);display:grid;place-items:center;padding:6px}
.app-logo svg{width:100%;height:100%}
.app-name{font-weight:800;font-size:12px;color:var(--ink);letter-spacing:.5px}
.nav{display:flex;gap:6px;flex-wrap:wrap}
.nav a{padding:10px 12px;border-radius:12px;border:1px solid transparent}
.nav a:hover,.nav a.active{background:rgba(0,0,0,.05);border-color:var(--border)}
.theme-toggle{border:1px solid var(--border);background:var(--card);border-radius:10px;padding:8px 10px;line-height:0}
.hamburger{display:none;border:1px solid var(--border);background:var(--card);border-radius:10px;padding:10px;line-height:0}
/* LEFT: Vision + Talbiya + audio */
.left-logos{display:flex;align-items:center;gap:10px;min-width:0}
.logo{display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--border);border-radius:12px;background:var(--badge);padding:6px;height:38px}
.logo img,.logo svg{max-height:100%;max-width:100%;object-fit:contain}
.audio-btn{border:1px solid var(--border);padding:8px 12px;border-radius:10px;background:var(--card)}

/* Layout */
main{padding-bottom:90px}.section{margin-top:16px}
.card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:14px}
.shadow{box-shadow:0 10px 30px rgba(0,0,0,.06)}
.grid{display:grid;gap:12px}.cols-2{grid-template-columns:1fr 1fr}.cols-3{grid-template-columns:repeat(3,1fr)}
@media(max-width:980px){.cols-2,.cols-3{grid-template-columns:1fr}}

/* Hero */
.hero{display:grid;gap:16px;grid-template-columns:1.1fr 1fr;align-items:center;padding:16px;border:1px solid var(--border);border-radius:24px;background:linear-gradient(135deg,#0f6781 0%,#2a7c92 60%,rgba(212,169,68,.45) 100%);color:#fff}
.hero h1{margin:0 0 10px;font-size:28px}.hero p{margin:0;color:#eaf7ff}
.hero .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.btn{border:none;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer}
.btn-primary{background:var(--gold);color:#1a2228}.btn-primary:hover{background:#c79b34}
.btn-ghost{background:transparent;border:1px dashed var(--border);color:#fff}
.verse-box{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);border-radius:18px;padding:16px;text-align:center;font-family:"Amiri","Scheherazade New",serif}
.verse-box .ayah{font-size:22px;line-height:1.9}
.kpis{display:flex;gap:10px;flex-wrap:wrap}
.kpi{flex:1 1 180px;background:#ffffff1a;border:1px solid rgba(255,255,255,.35);border-radius:12px;padding:10px}.kpi b{display:block;font-size:18px}.kpi span{font-size:12px}
.input,select,textarea{width:100%;padding:14px 12px;border:1px solid var(--border);border-radius:14px;background:var(--card);color:var(--ink)}
.range{width:100%;height:34px}
.range::-webkit-slider-thumb{-webkit-appearance:none;width:28px;height:28px;border-radius:50%;background:var(--blue2);border:3px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.2)}
.range::-moz-range-thumb{width:28px;height:28px;border-radius:50%;background:var(--blue2);border:none}
.small{font-size:12px;color:var(--muted)}.badge{display:inline-block;padding:4px 10px;border-radius:999px;background:var(--badge);border:1px solid var(--border);font-size:12px}
.separator{height:1px;background:var(--border);margin:8px 0}.notice{padding:10px;border:1px solid var(--border);background:#fffdf5;border-radius:12px}
.radar{padding:10px;background:var(--card);border:1px solid var(--border);border-radius:16px}.table-wrap{overflow:auto;-webkit-overflow-scrolling:touch}
.table{width:100%;border-collapse:separate;border-spacing:0;min-width:520px}.table th,.table td{border:1px solid var(--border);padding:10px;border-left:none;border-top:none}
.table th:first-child,.table td:first-child{border-right:1px solid var(--border)}.table tr:last-child td{border-bottom:1px solid var(--border)}.table th{background:#f8fafc}

/* Animations */
@keyframes fadeUp { from{opacity:0; transform: translateY(12px);} to{opacity:1; transform: translateY(0);} }
.reveal>*{opacity:0; transform:translateY(12px)}
.reveal>.anim{animation: fadeUp .6s ease both}
.reveal .anim-1{animation-delay:.05s}.reveal .anim-2{animation-delay:.12s}.reveal .anim-3{animation-delay:.18s}.reveal .anim-4{animation-delay:.24s}.reveal .anim-5{animation-delay:.30s}
/* Drawer slide-in */
@keyframes slideIn { from{transform:translateX(12px);opacity:0} to{transform:translateX(0);opacity:1} }
.nav.open{animation:slideIn .25s ease both}
@media (prefers-reduced-motion: reduce){ .reveal>*{opacity:1;transform:none} .anim{animation:none} .nav.open{animation:none} }

/* Transition highlight (title flash) */
@keyframes goldFlash { 0%{box-shadow:0 0 0 rgba(212,169,68,0)} 100%{box-shadow:0 0 0 rgba(212,169,68,0)} }
.flash-gold{background:linear-gradient(90deg, rgba(212,169,68,.25), rgba(212,169,68,.05)); border-radius:10px; padding:3px 6px; animation: goldFlash .5s ease;}

/* Welcome bar */
.welcome-bar{position:sticky;top:64px;z-index:35;margin:0 14px 8px;border-radius:12px;border:1px solid rgba(212,169,68,.35);
 background:linear-gradient(90deg,rgba(212,169,68,.65),rgba(212,169,68,.45)); color:#fff; font-family:"Amiri",serif;
 text-align:center; padding:8px 12px; opacity:0; transform:translateY(-6px); pointer-events:none;
 text-shadow:0 1px 2px rgba(0,0,0,.25);}
.welcome-bar.show{opacity:1; transform:translateY(0); transition:opacity .25s ease, transform .25s ease;}
.welcome-bar.hide{opacity:0; transform:translateY(-6px); transition:opacity .3s ease, transform .3s ease;}

/* Footer */
.footer{text-align:center;color:var(--muted);font-size:12px;padding:20px 0;border-top:1px solid var(--border);background:rgba(255,255,255,.6)}

/* Mobile header/menu */
@media(max-width:840px){
  .app-logo{width:48px;height:48px;border-radius:12px}
  .logo{height:34px}
  .hamburger{display:inline-flex}
  .nav{display:none;position:fixed;right:12px;left:12px;top:68px;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:8px;flex-direction:column;box-shadow:0 14px 40px rgba(0,0,0,.12)}
  .nav.open{display:flex}
}

/* Print (roadmap) */
@media print {
  header,.nav,.left-logos,.footer, .breadcrumbs, .btn, .welcome-bar {display:none !important}
  main {padding:0} .card {border:none} body {background:#fff;color:#000}
}

/* Modal (partners) */
dialog.partner-modal{border:none;border-radius:18px;max-width:560px;width:92vw;background:var(--card);color:var(--ink);box-shadow:0 20px 60px rgba(0,0,0,.25);padding:0}
.partner-modal::backdrop{background:rgba(0,0,0,.35)}
.modal-head{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.modal-body{padding:16px}
.modal-actions{display:flex;gap:8px;justify-content:flex-start;padding:12px 16px;border-top:1px solid var(--border)}
.close-btn{border:1px solid var(--border);background:var(--card);border-radius:10px;padding:8px 12px}
</style>
</head>
<body>
<div class="skip"><a href="#content">ุชุฌุงูุฒ ุฅูู ุงููุญุชูู</a></div>

<header class="header" role="banner">
  <div class="container header-inner">
    <!-- RIGHT: brand (app logo + nav) -->
    <div class="brand">
      <div class="app-logo-wrap">
        <div class="app-logo" title="ููุตุฉ ุฒุฏ ุฅููุงูู" aria-label="ุดุนุงุฑ ุงูููุตุฉ">
          <svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs><radialGradient id="g" cx="50%" cy="50%" r="60%">
              <stop offset="0%" stop-color="#FACC15" stop-opacity=".95"/>
              <stop offset="60%" stop-color="#60A5FA" stop-opacity=".9"/>
              <stop offset="100%" stop-color="#14B8A6" stop-opacity=".85"/>
            </radialGradient></defs>
            <rect width="256" height="256" rx="44" ry="44" fill="url(#g)"/>
            <circle cx="128" cy="128" r="86" fill="rgba(255,255,255,.15)"/>
            <text x="50%" y="57%" text-anchor="middle" font-family="Tajawal" font-size="120" fill="#0F172A">ุฒ</text>
          </svg>
        </div>
        <div class="app-name">ุฒุฏ ุฅููุงูู</div>
      </div>
      <button id="menuBtn" class="hamburger" aria-label="ุงููุงุฆูุฉ">โฐ</button>
      <nav class="nav" id="nav" role="navigation" aria-label="ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ"></nav>
      <button id="themeBtn" class="theme-toggle" title="ุงููุถุน ุงูุฏุงูู/ุงููุงุชุญ" aria-label="ุชุจุฏูู ุงููุถุน">๐</button>
    </div>

    <!-- LEFT: Vision 2030 + Talbiya (inline SVG placeholders) + audio -->
    <div class="left-logos">
      <div class="logo" title="Vision 2030">
        <!-- SVG placeholder for Vision 2030 -->
        <svg viewBox="0 0 180 44" aria-hidden="true"><rect x="0" y="0" width="180" height="44" rx="10" fill="#f7fafc" stroke="#e6ecf2"/>
          <text x="50%" y="60%" text-anchor="middle" font-family="Tajawal" font-weight="700" font-size="18" fill="#0f6781">VISION 2030</text>
        </svg>
      </div>
      <div class="logo" title="Talbiya">
        <!-- SVG placeholder for Talbiya -->
        <svg viewBox="0 0 120 44" aria-hidden="true"><rect x="0" y="0" width="120" height="44" rx="10" fill="#f7fafc" stroke="#e6ecf2"/>
          <text x="50%" y="60%" text-anchor="middle" font-family="Tajawal" font-weight="700" font-size="16" fill="#2a7c92">Talbiya</text>
        </svg>
      </div>
      <button id="audioBtn" class="audio-btn" aria-label="ุชุดุบูู ุงูุชูุงูุฉ">๐</button>
    </div>
  </div>
</header>

<!-- Welcome bar -->
<div id="welcomeBar" class="welcome-bar" role="status" aria-live="polite" style="display:none"></div>

<audio id="recitation" loop preload="auto">
  <!-- ุถุน ููู ุชูุงูุฉ ุฅู ุฑุบุจุช -->
  <!-- <source src="abdulbasit.mp3" type="audio/mpeg"/> -->
</audio>

<main id="content" class="container" role="main">
  <section id="page-home" class="page" aria-labelledby="homeTitle">
    <div class="hero shadow reveal">
      <div class="anim anim-1">
        <h1 id="homeTitle">ุฅููุงูู ุงููุนุงุตุฑ โ ุฒุฏ ุฅููุงูู</h1>
        <p>ููุตูุฉ ุนูููุฉ ุชุนุฒูุฒ ุงูุฅููุงู ุนุจุฑ ุงูุฃุณูุงุก ุงูุญุณููุ ูุชุฑุจุท ุชูุฏููู ุจุณูููู ูุงูููุฒุ ูุฑูู ูุงุณููุ ูุนุฌูุฉ ุงูุญูุงุฉ โ ุซู ุชููุญู ุฎุทุฉ 14 ููููุง ูุณุชูุฏุฉ ุฅูู ุขูุงุช ูุญููุฉ ููุณูุฉ.</p>
        <div class="btns anim anim-2">
          <a class="btn btn-primary" href="#/assessment">ุงุจุฏุฃ ุงูุชูููู ุงูุขู</a>
          <a class="btn btn-ghost" href="#/vision2030">ุงูุงุฑุชุจุงุท ุจุฑุคูุฉ 2030</a>
        </div>
        <div class="kpis" style="margin-top:12px">
          <div class="kpi anim anim-3"><b id="kpiFaith">โ%</b><span>ูุณุจุฉ ุงูุฅููุงู (ูุชูุณุท ุงูุฃุณูุงุก)</span></div>
          <div class="kpi anim anim-4"><b id="kpiHawkins">โ</b><span>ูุณุชูู ุณูููู ูุงูููุฒ</span></div>
          <div class="kpi anim anim-5"><b id="kpiMaslow">โ</b><span>ุทุจูุฉ ูุงุณูู ุงูุญุงููุฉ</span></div>
        </div>
      </div>
      <div class="verse-box anim anim-2"><div class="ayah">๏ดฟููููููููู ุงูุฃูุณูููุงุกู ุงููุญูุณูููู ููุงุฏูุนูููู ุจูููุง๏ดพ</div><div class="small">ุงูุฃุนุฑุงู: 180</div></div>
    </div>

    <div class="section grid cols-2 reveal">
      <div class="card anim anim-1">
        <h3>ููู ูุนููุ</h3>
        <ol class="small" style="line-height:1.9;padding-right:18px">
          <li>ูููู ุนูู ุฅููุงูู (0โ100) ูู <b>ุงูุฃุณูุงุก ุงูุญุณูู</b> ุงููุฎุชุงุฑุฉ.</li>
          <li>ูุญุชุณุจ ุงููุชูุณุท ูููุณููุทู ุนูู <b>ุณูููู ูุงูููุฒ</b> ููุญุฏูุฏ ุทุจูุฉ <b>ูุงุณูู</b>.</li>
          <li>ุงููุฃ <b>ุนุฌูุฉ ุงูุญูุงุฉ</b> (8 ุฌูุงูุจ) ูุชูุจูู <b>ุฎุฑูุทุฉ ุทุฑูู</b> ูู 14 ููููุง ุจุขูุงุช ูุชูุงุฑูู ููุณูุฉ.</li>
        </ol>
      </div>
      <div class="card anim anim-2">
        <h3>ุนุฌูุฉ ุงูุญูุงุฉ</h3>
        <div class="radar"><canvas id="radar" height="260" aria-label="ุฑุณู ุฑุงุฏุงุฑู ูุนุฌูุฉ ุงูุญูุงุฉ" role="img"></canvas></div>
        <div class="small" style="margin-top:6px;color:var(--muted)">ุนุฏูู ุงูููู ูู ุตูุญุฉ โุงูุชููููโ ูุชุฑู ุงูุชุบููุฑ ููุฑูุง.</div>
      </div>
    </div>
  </section>

  <section id="page-assessment" class="page hide" aria-labelledby="assessTitle">
    <div class="reveal">
      <nav class="breadcrumbs anim anim-1"><a href="#/">ุงูุฑุฆูุณูุฉ</a><span class="dot"></span><b id="assessTitle">ุงูุชูููู ุงูุฅููุงูู</b></nav>
      <div class="grid cols-2">
        <div class="card anim anim-2">
          <h3 class="title-flash-target">ูก) ุชูููู ุงูุฃุณูุงุก ุงูุญุณูู (ุจุญุซ + ูฉูฉ ุงุณููุง)</h3>
          <div style="display:flex;gap:8px;align-items:center;margin:6px 0">
            <input id="searchName" class="input" placeholder="ุงุจุญุซ ุนู ุงุณู (ูุซุงู: ุงูุดุงููุ ุงูุญูููุ ุงูุฑุฒูุงู)" aria-label="ุงุจุญุซ ุนู ุงุณู ูู ุงูุฃุณูุงุก ุงูุญุณูู"/><span class="badge">ุงุฎุชุฑ ููููู 0โ100</span>
          </div>
          <div id="namesWrap" class="grid cols-2" style="margin-top:8px;max-height:420px;overflow:auto"></div>
          <div class="separator"></div>
          <button class="btn btn-primary" onclick="saveNames()">ุญูุธ ุงูุชูููู</button>
          <button class="btn" onclick="exportData()">ุชุตุฏูุฑ ุงูุจูุงูุงุช</button>
          <label class="btn" for="importFile" style="cursor:pointer">ุงุณุชูุฑุงุฏ</label>
          <input id="importFile" type="file" accept="application/json" style="display:none" onchange="importData(event)"/>
        </div>
        <div class="card anim anim-3">
          <h3>ูข) ุนุฌูุฉ ุงูุญูุงุฉ (ูจ ุฌูุงูุจ)</h3>
          <p class="small" style="color:var(--muted)">ูููู ุฑุถุงู ุงูุญุงูู (0โ10) ูู ูู ุฌุงูุจ.</p>
          <div id="lifeWrap" class="grid cols-2" style="margin-top:8px"></div>
          <div class="separator"></div>
          <button class="btn btn-primary" onclick="saveLife()">ุญูุธ ุงูุนุฌูุฉ</button>
          <button class="btn" onclick="shareProgress()">ูุดุงุฑูุฉ ุชูุฏูู</button>
        </div>
      </div>

      <div class="section grid cols-3">
        <div class="card anim anim-1">
          <h3>ูฃ) ุงููุชุงุฆุฌ ุงูููุฑูุฉ</h3>
          <div class="kpis">
            <div class="kpi"><b id="faithPct">โ%</b><span>ูุณุจุฉ ุงูุฅููุงู ุงูุนุงูุฉ</span></div>
            <div class="kpi"><b id="hawkinsLevel">โ</b><span>ูุณุชูู ูุงูููุฒ</span></div>
            <div class="kpi"><b id="maslowTier">โ</b><span>ุทุจูุฉ ูุงุณูู</span></div>
          </div>
          <p class="small" id="levelBlurb" style="margin-top:8px;color:var(--muted)"></p>
        </div>

        <div class="card anim anim-2">
          <h3>ูค) ุณูููู ูุงูููุฒ (ุชูุถูุญ)</h3>
          <div class="table-wrap">
            <table class="table small"><thead><tr><th>ุงููุทุงู</th><th>ุงูุดุนูุฑ ุงูุณุงุฆุฏ</th><th>ุงููููุฉ</th><th>ูุตู ูุชูุตูุฉ</th></tr></thead><tbody id="hawkinsTable"></tbody></table>
          </div>
        </div>

        <div class="card anim anim-3">
          <h3>ูฅ) ูุฑู ูุงุณูู (ุชูุถูุญ)</h3>
          <div class="table-wrap">
            <table class="table small">
              <thead><tr><th>ุงูุทุจูุฉ</th><th>ุงููุตู</th><th>ุชุทุจูู ุนููู</th></tr></thead>
              <tbody id="maslowTable">
                <tr><td>ูุณููููุฌู</td><td>ุทุนุงูุ ูููุ ุตุญุฉ</td><td>ุชูุธูู ุงูููู ูุงูุบุฐุงุก</td></tr>
                <tr><td>ุฃูุงู</td><td>ุงุณุชูุฑุงุฑุ ูุงูุ ุณูู</td><td>ููุฒุงููุฉ ุฃุณุจูุนูุฉ ูุฑูุชูู</td></tr>
                <tr><td>ุงูุชูุงุก</td><td>ุนูุงูุงุชุ ูุญุจูุฉ</td><td>ุตูุฉ ุฑุญู ูุตุญุจุฉ ุตุงูุญุฉ</td></tr>
                <tr><td>ุชูุฏูุฑ</td><td>ุฅูุฌุงุฒุ ุซูุฉ</td><td>ูุฏู ุตุบูุฑ ูุชุญูู ูููููุง</td></tr>
                <tr><td>ุชุญููู ุงูุฐุงุช</td><td>ุดุบูุ ูุนูู</td><td>ุฎุฏูุฉ ุงูุขุฎุฑูู/ุชุนููู ูุคุซุฑ</td></tr>
                <tr><td>ุงูุณููู ุจุงูุฅููุงู</td><td>ูุนู ุฑูุญู</td><td>ุฎููุฉ ูุฐูุฑ ูุชุฏุจุฑ</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="section"><a class="btn btn-primary anim anim-1" href="#/roadmap">ุฎุฑูุทุฉ ุงูุทุฑูู (ูกูค ููููุง)</a></div>
    </div>
  </section>

  <section id="page-roadmap" class="page hide" aria-labelledby="roadTitle">
    <div class="reveal">
      <nav class="breadcrumbs anim anim-1"><a href="#/">ุงูุฑุฆูุณูุฉ</a><span class="dot"></span><b id="roadTitle">ุฎุฑูุทุฉ ุงูุทุฑูู</b></nav>
      <div class="card anim anim-2">
        <h3 class="title-flash-target">ุฎุทุฉ ุดุฎุตูุฉ ููุฏุฉ ูกูค ููููุง</h3>
        <p class="small" style="color:var(--muted)">ูุจููุฉ ุนูู ูุณุจุฉ ุงูุฅููุงูุ ูุณุชูู ูุงูููุฒุ ุทุจูุฉ ูุงุณููุ ูุนุฌูุฉ ุงูุญูุงุฉ.</p>
        <div id="roadmapPlan" class="grid" style="margin-top:8px"></div>
        <div class="separator"></div>
        <button class="btn btn-primary" onclick="downloadPlan()">ุญูุธ ูููู HTML</button>
        <button class="btn btn-ghost" onclick="window.print()">ุทุจุงุนุฉ</button>
      </div>
    </div>
  </section>

  <section id="page-vision2030" class="page hide" aria-labelledby="vTitle">
    <div class="reveal">
      <nav class="breadcrumbs anim anim-1"><a href="#/">ุงูุฑุฆูุณูุฉ</a><span class="dot"></span><b id="vTitle">ุงูุงุฑุชุจุงุท ุจุฑุคูุฉ 2030</b></nav>
      <div class="grid cols-2">
        <div class="card anim anim-2">
          <h3 class="title-flash-target">ูุญุงูุฑ ุงูุงูุณุฌุงู</h3>
          <ul class="small" style="line-height:1.9;padding-right:18px">
            <li><b>ุชุนุฒูุฒ ุงูููู ุงูุฅุณูุงููุฉ ูุงููููุฉ ุงููุทููุฉ</b> โ ุงููุณุทูุฉ/ุงูุชุณุงูุญ/ุงูุฅุชูุงู/ุงูุนุฏุงูุฉ/ุงููุซุงุจุฑุฉ.</li>
            <li><b>ุชูููู ุญูุงุฉ ุนุงูุฑุฉ ูุตุญูุฉ</b> โ ููุท ุตุญูุ ุฌูุฏุฉ ุงูุญูุงุฉุ ุงูููุงูุฉุ ุซูุงูุฉ ูุชุฑููู ูุงุฏู.</li>
            <li><b>ุชูููู ุงููุณุคูููุฉ ุงูุงุฌุชูุงุนูุฉ</b> โ ุฃุซุฑ ุบูุฑ ุฑุจุญู ูุชูููู ูููุฑุฏ ูุงูููุธูุฉ.</li>
          </ul>
        </div>
        <div class="card anim anim-3">
          <h3>ูุคุดุฑุงุช ูุงุจูุฉ ููููุงุณ</h3>
          <ul class="small" style="line-height:1.9;padding-right:18px">
            <li>ุชุญุณูู ุซูุงุซุฉ ุฌูุงูุจ ุนูู ุงูุฃูู ูู ุนุฌูุฉ ุงูุญูุงุฉ.</li>
            <li>ุงุฑุชูุงุน โูุณุจุฉ ุงูุฅููุงูโ โฅ ุนุดุฑ ููุงุท ุฎูุงู ุฏูุฑุฉ.</li>
            <li>ุงูุงูุชูุงู ูุณุชูู ูุงุญุฏูุง ุนูู ุงูุฃูู ุนูู ุณูููู ูุงูููุฒ.</li>
          </ul>
          <div class="notice small">ุฅููุงููุฉ ุฑุจุท ุงููุคุดุฑุงุช ุจุจุฑุงูุฌ ุงูุชุทูุน ูุฌูุฏุฉ ุงูุญูุงุฉ ูุญูููุง.</div>
        </div>
      </div>
    </div>
  </section>

  <section id="page-partners" class="page hide" aria-labelledby="pTitle">
    <div class="reveal">
      <nav class="breadcrumbs anim anim-1"><a href="#/">ุงูุฑุฆูุณูุฉ</a><span class="dot"></span><b id="pTitle">ุดุฑูุงุคูุง</b></nav>
      <div class="card anim anim-2" style="text-align:center">
        <h3 class="title-flash-target" style="margin:0 0 8px">ุฏุนูุฉ ููุดุฑุงูุฉ</h3>
        <p class="small" style="color:var(--muted);margin:0 0 10px">
          ุงูุถูู ุฅูู ุดุฑูุงุก ุงูุฅููุงู ูุงูุชูููุฉุ ูู ุฌุฒุกูุง ูู ุฃุซุฑู ูุณุชุฏุงู ูุฏุนู ูุดุงุฑูุน ุงูููุตูุฉ ููููููู ุงููุนู ุงูุฑูุญู ูุงููุฌุชูุนู.
        </p>
        <button class="btn btn-primary" onclick="openPartnerForm()">ุงูุถูู ูุดุฑูู</button>
      </div>
      <div class="card anim anim-3">
        <h3>ุงูุดุฑูุงุก ูุงูุฏุงุนููู</h3>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;max-width:100%">
          <div class="logo" title="ูุจุงุฏุฑุฉ ุชูุจูุฉ">
            <!-- ูููู ุงุณุชุจุฏุงู ูุฐุง ุจู Base64 ููุดุนุงุฑ ุงูุญูููู -->
            <svg viewBox="0 0 120 44"><rect width="120" height="44" rx="10" fill="#f7fafc" stroke="#e6ecf2"/>
              <text x="50%" y="60%" text-anchor="middle" font-family="Tajawal" font-weight="700" font-size="16" fill="#2a7c92">ูุจุงุฏุฑุฉ ุชูุจูุฉ</text>
            </svg>
          </div>
          <div class="logo" title="ุดุฑูุฉ ุชูุจูุฉ">
            <svg viewBox="0 0 120 44"><rect width="120" height="44" rx="10" fill="#f7fafc" stroke="#e6ecf2"/>
              <text x="50%" y="60%" text-anchor="middle" font-family="Tajawal" font-weight="700" font-size="16" fill="#0f6781">ุดุฑูุฉ ุชูุจูุฉ</text>
            </svg>
          </div>
          <div class="logo"><span style="color:#64748b;font-weight:700">Partner</span></div>
        </div>
      </div>
    </div>
  </section>

  <section id="page-about" class="page hide" aria-labelledby="aTitle">
    <div class="reveal">
      <nav class="breadcrumbs anim anim-1"><a href="#/">ุงูุฑุฆูุณูุฉ</a><span class="dot"></span><b id="aTitle">ุนู ุงูููุตุฉ</b></nav>
      <div class="card anim anim-2">
        <h3 class="title-flash-target">ุนู ููุตุฉ ุฒุฏ ุฅููุงูู</h3>
        <p class="small" style="color:var(--muted)">
          ููุตูุฉ ุฑูููุฉ ุชุฃููููุฉ ูุชููููุฉ ุชุนุฒูุฒ ุงูุฅููุงู ุจุงููู ุนุจุฑ ุงูุชูุงุนู ูุน ุงูุฃุณูุงุก ุงูุญุณูู ูุชุทุจููุงุชูุง ุงูุนูููุฉุ ูุณุชูุฏุฉู ุฅูู ูุจุงุฏุฆ ุนูู ุงูููุณ ุงูุฅูุฌุงุจูุ
          ูุณูููู ูุงูููุฒ ููุณุชููุงุช ุงููุนูุ ููุฑู ูุงุณูู ููุงุญุชูุงุฌุงุชุ ูุชุฒููุฏู ุจุฎุฑูุทุฉ ุทุฑูู ุนูููุฉ ุชูุญุณูู ุฌูุฏุฉ ุญูุงุชู ุฑูุญุงูููุง ูููุณููุง ูุณูููููุง.
        </p>
        <h4>ุงูุฑุคูุฉ</h4>
        <p class="small">ุฃู ุชููู ุงูููุตูุฉ ุงููุฑุฌุน ุงูุฑููู ุงูุฃููู ูุชุทููุฑ ุงูุฅููุงู ุงููุงุนู ูู ุงูุนุงูู ุงูุนุฑุจู.</p>
        <h4>ุงูุฑุณุงูุฉ</h4>
        <p class="small">ุชูููู ุงูุฃูุฑุงุฏ ูู ุจูุงุก ุชูุงุฒู ุฑูุญุงูู ูููุณู ูุณูููู ุนุจุฑ ุชููููู ูุชุฃูููู ูุฎุทุทู ุชููููุฉู ุชุณุชูุฏ ุฅูู ุงูููู ุงููุฑุขููุฉ ูุงูุนูููุฉ.</p>
        <h4>ุงูุฃูุฏุงู</h4>
        <ul class="small" style="line-height:1.9;padding-right:18px">
          <li>ุฑุจุท ุงูุฅููุงู ุจุงููุนู ูุงูุณููู ุงููููู ุจุตูุฑุฉู ุนูููุฉู ูุฑูุญูุฉู.</li>
          <li>ุชุนุฑูู ุงููุณุชุฎุฏู ุจูุณุชูู ูุนูู ููู ุณูููู ูุงูููุฒ ูุฅุถุงุกุงุชู ุนูููุฉู.</li>
          <li>ุชุญููู ุงูุชูุงุฒู ุนุจุฑ ุทุจูุงุช ูุฑู ูุงุณูู ูุฌูุงูุจ ุนุฌูุฉ ุงูุญูุงุฉ.</li>
          <li>ุชูุฏูู ุฎุทุท ูกูค ููููุง ูุงุจูุฉู ููููุงุณ ููุฏุนููุฉู ุจุขูุงุชู ูุชูุงุฑููู ููุณูุฉู.</li>
          <li>ุงูุฅุณูุงู ูู ูุณุชูุฏูุงุช ุฑุคูุฉ 2030: ุฌูุฏุฉ ุงูุญูุงุฉ ูุชุนุฒูุฒ ุงูููู ุงูุฅุณูุงููุฉ.</li>
        </ul>
      </div>
    </div>
  </section>
</main>

<footer class="footer" role="contentinfo">ยฉ ุฌููุน ุงูุญููู ูุญููุธุฉ ูุดุฑูุฉ <b>ุชูุจูุฉ ููุจุญุซ ูุงูุชุทููุฑ</b> โ <span id="year"></span></footer>

<!-- Partner modal -->
<dialog class="partner-modal" id="partnerModal">
  <form method="dialog">
    <div class="modal-head">
      <b>ูููุฐุฌ ุงูุถูุงู ุงูุดุฑูุงุก</b>
      <button class="close-btn" onclick="partnerModal.close()">ุฅุบูุงู</button>
    </div>
    <div class="modal-body">
      <div class="grid cols-2">
        <label class="card"><span class="small">ุงูุงุณู ุงููุงูู</span><input id="pf_name" class="input" required/></label>
        <label class="card"><span class="small">ุงูููุธูุฉ/ุงูุฌูุฉ</span><input id="pf_org" class="input"/></label>
      </div>
      <div class="grid cols-2" style="margin-top:8px">
        <label class="card"><span class="small">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</span><input id="pf_email" type="email" class="input" required/></label>
        <label class="card"><span class="small">ุงููุงุชู (ุงุฎุชูุงุฑู)</span><input id="pf_phone" class="input"/></label>
      </div>

      <!-- New dropdown (required) -->
      <div class="grid" style="margin-top:8px">
        <label class="card">
          <span class="small">ููุน ุงูุดุฑุงูุฉ</span>
          <select id="pf_type" class="input" required>
            <option value="" selected disabled>ุงุฎุชุฑ ุงูููุน</option>
            <option>ูุงููุฉ</option>
            <option>ุนูููุฉ</option>
            <option>ุฅุนูุงููุฉ</option>
            <option>ุชูููุฉ</option>
            <option>ุฃุฎุฑู</option>
          </select>
        </label>
      </div>

      <label class="card" style="margin-top:8px"><span class="small">ุฑุณุงูุฉ/ุงูุชูุงู</span><textarea id="pf_msg" class="input" rows="4" placeholder="ุนุฑูู ุจูุง ูุจูุฌุงู ุงูุดุฑุงูุฉ ุงููุฑุบูุจ"></textarea></label>
      <div class="notice small" style="margin-top:8px">ุณูุชู ุฅูุดุงุก ุจุฑูุฏ ูุณูุฏูุฉ ุชููุงุฆููุง ุจุงูุจูุงูุงุช ูุฅุฑุณุงูู ููุง.</div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-primary" onclick="submitPartnerForm()">ุฅุฑุณุงู</button>
      <button class="btn" type="reset">ุชูุฑูุบ</button>
    </div>
  </form>
</dialog>

<script>
/* Manifest + SW with offline fallback */
const OFFLINE_HTML = `<!doctype html><meta charset="utf-8"><title>ูุถุน ุนุฏู ุงูุงุชุตุงู</title><style>body{font-family:system-ui,"Tajawal";direction:rtl;padding:20px}</style><h2>ุฃูุช ุบูุฑ ูุชุตู</h2><p>ููููู ุงุณุชุฎุฏุงู ุงูุฃุฌุฒุงุก ุงููุญููุธุฉ ูุณุจููุง ูู ุงูููุตุฉุ ูุณูุชู ุชุญุฏูุซูุง ุนูุฏ ุนูุฏุฉ ุงูุงุชุตุงู.</p>`;
const manifest={"name":"ููุตุฉ ุฒุฏ ุฅููุงูู","short_name":"ุฒุฏ ุฅููุงูู","start_url":"./?pwa=true","display":"standalone","lang":"ar","dir":"rtl","theme_color":"#0f6781","background_color":"#ffffff","icons":[
  {"src":"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'><rect rx='28' ry='28' width='128' height='128' fill='%230f6781'/><text x='64' y='84' text-anchor='middle' font-size='84' fill='white'>ุฒ</text></svg>","sizes":"128x128","type":"image/svg+xml"},
  {"src":"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect rx='80' ry='80' width='512' height='512' fill='%230f6781'/><text x='256' y='320' text-anchor='middle' font-size='300' fill='white'>ุฒ</text></svg>","sizes":"512x512","type":"image/svg+xml","purpose":"maskable any"}
]};
(function attachManifest(){
  const link=document.getElementById('manifestLink');
  const url=URL.createObjectURL(new Blob([JSON.stringify(manifest)],{type:'application/manifest+json'}));
  link.href=url;
})();
(function registerSW(){
  if('serviceWorker' in navigator){
    const sw = `const CACHE='iman-v3';let OFFLINE_URL='offline.html';self.addEventListener('install',e=>{e.waitUntil((async()=>{const c=await caches.open(CACHE);await c.addAll(['./',OFFLINE_URL]);})());self.skipWaiting();});self.addEventListener('activate',e=>self.clients.claim());self.addEventListener('fetch',e=>{e.respondWith((async()=>{try{const r=await fetch(e.request);const c=await caches.open(CACHE);c.put(e.request,r.clone());return r;}catch(err){const m=await caches.match(e.request);return m||caches.match(OFFLINE_URL);}})());});`;
    const offlineUrl = URL.createObjectURL(new Blob([OFFLINE_HTML],{type:'text/html'}));
    const swUrl = URL.createObjectURL(new Blob([sw.replace("OFFLINE_URL='offline.html'","OFFLINE_URL='"+offlineUrl+"'")],{type:'text/javascript'}));
    navigator.serviceWorker.register(swUrl);
  }
})();

/* Install prompt */
let deferredPrompt;window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();deferredPrompt=e;const install=document.createElement('button');install.textContent='๐ฒ ุชุซุจูุช ุงูุชุทุจูู';install.className='btn';install.style.marginRight='8px';document.querySelector('.btns')?.prepend(install);install.addEventListener('click',async()=>{install.disabled=true;try{await deferredPrompt.prompt();}catch{}});});

/* Theme toggle */
const themeBtn=document.getElementById('themeBtn');themeBtn.addEventListener('click',()=>{document.documentElement.classList.toggle('force-dark');if(document.documentElement.classList.contains('force-dark')){document.documentElement.style.colorScheme='dark';}else{document.documentElement.style.colorScheme='light';}});

/* Build navigation */
const routes=[
  {hash:"#/",label:"ุงูุฑุฆูุณูุฉ", welcome:"ูุฑุญุจูุง ุจู ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ"},
  {hash:"#/assessment",label:"ุงูุชูููู", welcome:"ูุฑุญุจูุง ุจู ูู ุตูุญุฉ ุงูุชูููู"},
  {hash:"#/roadmap",label:"ุฎุฑูุทุฉ ุงูุทุฑูู", welcome:"ูุฑุญุจูุง ุจู ูู ุตูุญุฉ ุฎุฑูุทุฉ ุงูุทุฑูู"},
  {hash:"#/vision2030",label:"ุงูุงุฑุชุจุงุท ุจุฑุคูุฉ 2030", welcome:"ูุฑุญุจูุง ุจู ูู ุตูุญุฉ ุฑุคูุฉ 2030"},
  {hash:"#/partners",label:"ุดุฑูุงุคูุง", welcome:"ูุฑุญุจูุง ุจู ูู ุตูุญุฉ ุงูุดุฑูุงุก"},
  {hash:"#/about",label:"ุนู ุงูููุตุฉ", welcome:"ูุฑุญุจูุง ุจู ูู ุตูุญุฉ ุนู ุงูููุตุฉ"}
];
const nav=document.getElementById('nav');
routes.forEach(r=>{const a=document.createElement('a');a.href=r.hash;a.textContent=r.label;a.setAttribute('data-route','');nav.appendChild(a);});
const menuBtn=document.getElementById('menuBtn');menuBtn.addEventListener('click',()=>{nav.classList.toggle('open');});
document.addEventListener('click',(e)=>{if(!nav.contains(e.target) && e.target!==menuBtn) nav.classList.remove('open');},{passive:true});

/* Router + page animation trigger + aria-current + welcome bar + title flash */
const welcomeBar=document.getElementById('welcomeBar');
function showWelcome(text){
  if(!welcomeBar) return;
  welcomeBar.textContent=text;
  welcomeBar.style.display='block';
  welcomeBar.classList.remove('hide');
  requestAnimationFrame(()=>welcomeBar.classList.add('show'));
  setTimeout(()=>{welcomeBar.classList.remove('show');welcomeBar.classList.add('hide');}, 2000);
  setTimeout(()=>{welcomeBar.style.display='none';welcomeBar.classList.remove('hide');}, 2400);
}
function flashTitle(){
  const page=document.querySelector('.page:not(.hide)');
  const target=page?.querySelector('.title-flash-target') || page?.querySelector('h1, h3');
  if(!target) return;
  target.classList.add('flash-gold');
  setTimeout(()=>target.classList.remove('flash-gold'), 500);
}
function applyReveal(){
  const page=document.querySelector('.page:not(.hide) .reveal');
  if(!page) return;
  [...page.children].forEach((c,i)=>{ if(!c.classList.contains('anim')) c.classList.add('anim'); c.style.animationDelay = (0.06*i)+'s'; });
  page.classList.remove('reveal'); void page.offsetWidth; page.classList.add('reveal');
  [...page.querySelectorAll('.anim')].forEach(el=>{ el.style.animation='fadeUp .6s ease both'; });
}
function route(){
  const h=location.hash||"#/";
  document.querySelectorAll('.page').forEach(p=>p.classList.add('hide'));
  const id=h==="#/"?"page-home":h==="#/assessment"?"page-assessment":h==="#/roadmap"?"page-roadmap":h==="#/vision2030"?"page-vision2030":h==="#/partners"?"page-partners":"page-about";
  document.getElementById(id).classList.remove('hide');
  document.querySelectorAll('[data-route]').forEach(a=>{a.classList.toggle('active',a.getAttribute('href')===h); if(a.getAttribute('href')===h) a.setAttribute('aria-current','page'); else a.removeAttribute('aria-current');});
  nav.classList.remove('open');
  const r=routes.find(x=>x.hash===h)||routes[0];
  showWelcome(r.welcome);
  if(h==="#/assessment"){buildNames();buildLife();randomAyah();fillHawkinsTable();setTimeout(fillHawkinsBar,0);}
  if(h==="#/roadmap"){renderRoadmap();}
  if(h!=="#/"){audioPauseSoft();}
  window.scrollTo({top:0,behavior:'smooth'});
  applyReveal();
  flashTitle();
}
window.addEventListener('hashchange',route);

/* Audio */
const audio=document.getElementById('recitation');const audioBtn=document.getElementById('audioBtn');let audioOn=false;
function audioPauseSoft(){if(!audio.paused){audio.pause();audioOn=false;audioBtn.textContent='๐';}}
audioBtn.addEventListener('click', async ()=>{try{if(!audioOn){await audio.play();audioOn=true;audioBtn.textContent='โธ';}else{audio.pause();audioOn=false;audioBtn.textContent='๐';}}catch(e){}}, {passive:true});

/* Gentle UI sound via WebAudio */
function uiPing(){
  try{
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const o=ctx.createOscillator();const g=ctx.createGain();
    o.type='sine';o.frequency.value=660;g.gain.value=0.0001;
    o.connect(g);g.connect(ctx.destination);
    o.start();g.gain.exponentialRampToValueAtTime(0.06, ctx.currentTime+0.12);
    setTimeout(()=>{o.stop();ctx.close();},160);
  }catch(_){}
}

/* Data + helpers */
const NAMES_99=["ุงููู","ุงูุฑุญูู","ุงูุฑุญูู","ุงูููู","ุงููุฏูุณ","ุงูุณูุงู","ุงููุคูู","ุงูููููู","ุงูุนุฒูุฒ","ุงูุฌุจุงุฑ","ุงููุชูุจุฑ","ุงูุฎุงูู","ุงูุจุงุฑุฆ","ุงููุตูุฑ","ุงูุบูุงุฑ","ุงูููุงุฑ","ุงูููุงุจ","ุงูุฑุฒุงู","ุงููุชุงุญ","ุงูุนููู","ุงููุงุจุถ","ุงูุจุงุณุท","ุงูุฎุงูุถ","ุงูุฑุงูุน","ุงููุนุฒ","ุงููุฐู","ุงูุณููุน","ุงูุจุตูุฑ","ุงูุญูู","ุงูุนุฏู","ุงููุทูู","ุงูุฎุจูุฑ","ุงูุญููู","ุงูุนุธูู","ุงูุบููุฑ","ุงูุดููุฑ","ุงูุนูู","ุงููุจูุฑ","ุงูุญููุธ","ุงููููุช","ุงูุญุณูุจ","ุงูุฌููู","ุงููุฑูู","ุงูุฑููุจ","ุงููุฌูุจ","ุงููุงุณุน","ุงูุญููู","ุงููุฏูุฏ","ุงููุฌูุฏ","ุงูุจุงุนุซ","ุงูุดููุฏ","ุงูุญู","ุงููููู","ุงูููู","ุงููุชูู","ุงูููู","ุงูุญููุฏ","ุงููุญุตู","ุงููุจุฏุฆ","ุงููุนูุฏ","ุงููุญูู","ุงููููุช","ุงูุญู","ุงููููู","ุงููุงุฌุฏ","ุงููุงุฌุฏ","ุงููุงุญุฏ","ุงูุฃุญุฏ","ุงูุตูุฏ","ุงููุงุฏุฑ","ุงูููุชุฏุฑ","ุงูููุฏู","ุงููุคุฎุฑ","ุงูุฃูู","ุงูุขุฎุฑ","ุงูุธุงูุฑ","ุงูุจุงุทู","ุงููุงูู","ุงููุชุนุงูู","ุงูุจุฑ","ุงูุชูุงุจ","ุงูููุชูู","ุงูุนูู","ุงูุฑุคูู","ูุงูู ุงูููู","ุฐู ุงูุฌูุงู ูุงูุฅูุฑุงู","ุงูููุณุท","ุงูุฌุงูุน","ุงูุบูู","ุงููุบูู","ุงููุงูุน","ุงูุถุงุฑ","ุงููุงูุน","ุงูููุฑ","ุงููุงุฏู","ุงูุจุฏูุน","ุงูุจุงูู","ุงููุงุฑุซ","ุงูุฑุดูุฏ","ุงูุตุจูุฑ","ุงูุดุงูู"];
const LIFE_AREAS=["ุงูุฅููุงู/ุงูุฑูุญ","ุงูุตุญุฉ","ุงูุนุงุฆูุฉ","ุงูุนูุงูุงุช","ุงูุนูู/ุงููุงู","ุงูุนูู/ุงูุชุนูู","ุงูุนุทุงุก/ุงูุฃุซุฑ","ุงูููุงูุงุช/ุงููุชุนุฉ"];
const K={names:"iman_names",life:"iman_life"};function load(k){try{return JSON.parse(localStorage.getItem(k))}catch{return null)}
function save(k,v){localStorage.setItem(k,JSON.stringify(v));}
let namesScores=load(K.names)||Object.fromEntries(NAMES_99.map(n=>[n,50]));let lifeScores=load(K.life)||Object.fromEntries(LIFE_AREAS.map(n=>[n,5]));
function byId(id){return document.getElementById(id)}function el(tag,attrs={},children=[]){const e=document.createElement(tag);Object.entries(attrs).forEach(([k,v])=>{if(k==="class")e.className=v;else if(k==="html")e.innerHTML=v;else e.setAttribute(k,v);});(Array.isArray(children)?children:[children]).filter(Boolean).forEach(c=>e.appendChild(c));return e;}
function avg(vals){return vals.reduce((a,b)=>a+b,0)/Math.max(vals.length,1);}

/* Names UI */
function buildNames(){const wrap=byId('namesWrap');wrap.innerHTML="";const q=(byId('searchName').value||"").trim();const list=q?NAMES_99.filter(n=>n.includes(q)):NAMES_99;list.forEach(name=>{const val=namesScores[name]??50;wrap.appendChild(el("div",{class:"card anim"},[el("div",{html:`<b>${name}</b> <span class='badge' style='float:left'>${val}%</span>`}),el("input",{type:"range",min:"0",max:"100",value:String(val),class:"range",oninput:`updateName('${name}', this.value, this.previousElementSibling.querySelector('.badge'))`})]));});}
document.getElementById('searchName')?.addEventListener('input',buildNames,{passive:true});
function updateName(name,val,b){namesScores[name]=Number(val);b.textContent=val+"%";}
function saveNames(){save(K.names,namesScores);refreshAll();uiPing();alert("ุชู ุญูุธ ุชูููู ุงูุฃุณูุงุก.");}

/* Export/Import */
function exportData(){const data={names:namesScores,life:lifeScores};const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='iman-data.json';a.click();}
function importData(e){const f=e.target.files?.[0];if(!f)return;const r=new FileReader();r.onload=()=>{try{const obj=JSON.parse(r.result);if(obj.names)namesScores=obj.names;if(obj.life)lifeScores=obj.life;save(K.names,namesScores);save(K.life,lifeScores);buildNames();buildLife();drawRadar();refreshAll();alert("ุชู ุงูุงุณุชูุฑุงุฏ ุจูุฌุงุญ.");}catch{alert("ููู ุบูุฑ ุตุงูุญ.");}};r.readAsText(f);}

/* Life Wheel */
function buildLife(){const wrap=byId('lifeWrap');wrap.innerHTML="";LIFE_AREAS.forEach(area=>{const val=lifeScores[area]??5;wrap.appendChild(el("div",{class:"card anim"},[el("div",{html:`<b>${area}</b> <span class='badge' style='float:left'>${val}/10</span>`}),el("input",{type:"range",min:"0",max:"10",value:String(val),class:"range",oninput:`updateLife('${area}', this.value, this.previousElementSibling.querySelector('.badge'))`})]));});}
function updateLife(area,val,b){lifeScores[area]=Number(val);b.textContent=val+"/10";}
function saveLife(){save(K.life,lifeScores);drawRadar();refreshAll();uiPing();alert("ุชู ุญูุธ ุนุฌูุฉ ุงูุญูุงุฉ.");}

/* Hawkins / Maslow */
const HAWK_MAP=[
  {range:"0โ20",label:"ุฎุฒู/ุนุงุฑ",code:20,note:"ุจุฏุก ูุจูู ุงูุฐุงุช ูุงูุฑุญูุฉ",color:"#ef4444"},
  {range:"20โ35",label:"ุฐูุจ/ุฃุณู",code:75,note:"ุชูุจุฉ + ุงูุชูุงู ูููู",color:"#f97316"},
  {range:"35โ50",label:"ุฎูู/ููู",code:100,note:"ุชูููู ุนููู",color:"#f59e0b"},
  {range:"50โ60",label:"ุดุฌุงุนุฉ",code:200,note:"ุนุงุฏุฉ ุตุบูุฑุฉ ูุณุชูุฑุฉ",color:"#84cc16"},
  {range:"60โ70",label:"ูุจูู/ุญูุงุฏ",code:300,note:"ุงุชุฒุงู ูุฑูุชูู ุฐูุฑ",color:"#22c55e"},
  {range:"70โ80",label:"ูุญุจูุฉ/ุจูุฌุฉ",code:500,note:"ุชูุซูุฑ ุงูุนุทุงุก",color:"#10b981"},
  {range:"80โ90",label:"ุณูุงู",code:600,note:"ุฎููุฉ ูุชุฏุจุฑ",color:"#06b6d4"},
  {range:"90โ100",label:"ููุฑ/ุณููู",code:700,note:"ุตูุงุก ูุฎุฏูุฉ ุจุฅุฎูุงุต",color:"#6366f1"}
];
function fillHawkinsTable(){const tbody=byId('hawkinsTable');tbody.innerHTML="";HAWK_MAP.forEach(row=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${row.range}</td><td>${row.label}</td><td>${row.code}</td><td>${row.note}</td>`;tbody.appendChild(tr);});}
function computeFaithPct(){return Math.round(avg(Object.values(namesScores)));}
function computeLifeAvg(){return avg(Object.values(lifeScores));}
function mapHawkins(pct){if(pct<20)return HAWK_MAP[0];if(pct<35)return HAWK_MAP[1];if(pct<50)return HAWK_MAP[2];if(pct<60)return HAWK_MAP[3];if(pct<70)return HAWK_MAP[4];if(pct<80)return HAWK_MAP[5];if(pct<90)return HAWK_MAP[6];return HAWK_MAP[7];}
function mapMaslow(avg10){if(avg10<3)return "ูุณููููุฌู/ุฃูุงู";if(avg10<5)return "ุงูุชูุงุก/ุนูุงูุงุช";if(avg10<7)return "ุชูุฏูุฑ/ุฅูุฌุงุฒ";return "ุชุญููู ุงูุฐุงุช (+ ุงูุณููู ุจุงูุฅููุงู)";}
function refreshAll(){const pct=computeFaithPct();const haw=mapHawkins(pct);const lifeAvg=computeLifeAvg();const mas=mapMaslow(lifeAvg);byId('kpiFaith').textContent=pct+"%";byId('kpiHawkins').textContent=`${haw.label} (${haw.code})`;byId('kpiMaslow').textContent=mas;byId('faithPct').textContent=pct+"%";byId('hawkinsLevel').textContent=`${haw.label} (${haw.code})`;byId('maslowTier').textContent=mas;byId('levelBlurb').textContent=`ูุจุฑุฉ ุงููุนู: ${haw.label} โ ุชูุตูุฉ: ${haw.note}`; }

/* Ayat */
const AYAT=[
  {text:"๏ดฟููููู ููุชูููููููู ุนูููู ุงูููููู ูููููู ุญูุณูุจููู๏ดพ",ref:"ุงูุทูุงู: 3"},
  {text:"๏ดฟุฅูููู ููุนู ุงููุนูุณูุฑู ููุณูุฑูุง๏ดพ",ref:"ุงูุดุฑุญ: 6"},
  {text:"๏ดฟูููู ููุง ุนูุจูุงุฏููู ุงูููุฐูููู ุฃูุณูุฑููููุง...๏ดพ",ref:"ุงูุฒูุฑ: 53"},
  {text:"๏ดฟุงุฏูุนููููู ุฃูุณูุชูุฌูุจู ูููููู๏ดพ",ref:"ุบุงูุฑ: 60"},
  {text:"๏ดฟููููู ุฑููุจูู ุฒูุฏูููู ุนูููููุง๏ดพ",ref:"ุทู: 114"}
];
function randomAyah(){const a=AYAT[Math.floor(Math.random()*AYAT.length)];const el=document.getElementById('dailyAyah');if(el)el.innerHTML=`<div class="ayah">${a.text}</div><div class="small">${a.ref}</div>`;}

/* Chart */
let radar;function drawRadar(){const ctx=document.getElementById('radar')?.getContext('2d');if(!ctx)return;const labels=LIFE_AREAS;const data=labels.map(l=>lifeScores[l]);if(radar)radar.destroy();radar=new Chart(ctx,{type:'radar',data:{labels,datasets:[{label:'ุนุฌูุฉ ุงูุญูุงุฉ',data,fill:true,borderWidth:2}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{r:{suggestedMin:0,suggestedMax:10,ticks:{stepSize:2}}}}});}

/* Roadmap (deeper mapping) */
const NAME_BY_STATE={low:"ุงูุฑุญูู", mid:"ุงููุทูู", high:"ุงูุญููู"};
const AYAH_BY_STATE={low:"๏ดฟููููู ููุชูููููููู ุนูููู ุงูููููู ูููููู ุญูุณูุจููู๏ดพ",mid:"๏ดฟุฅูููู ููุนู ุงููุนูุณูุฑู ููุณูุฑูุง๏ดพ",high:"๏ดฟููููู ุฑููุจูู ุฒูุฏูููู ุนูููููุง๏ดพ"};
const CBT_LIBRARY={thought:"ุงูุชุจ ููุฑุฉ ูุฒุนุฌุฉุ ุซู ุจุฏูููุง ูุงูุนููุง ุฑุญูููุงุ ูุทุจูู ุณููููุง ูุงูุนูุง ุตุบูุฑูุง.",gratitude:"ุณุฌู 3 ููุนูู ุงูููู ูุน ุณุจุจ ุงูุงูุชูุงู.",breath:"ุชูููุณ 4-4-6 ูุฏูููุฉ (ุดููู-ุซุจุงุช-ุฒููุฑ).",tinyHabit:"ุนุงุฏุฉ ุฏูููุฉ ูุฑุชุจุทุฉ ุจุฅุดุงุฑุฉ ุซุงุจุชุฉ (ุจุนุฏ ุตูุงุฉ/ูุจู ููู)."};
function stateBand(p){return p<60?'low':(p<80?'mid':'high');}
function roadmapBlocks(pct,haw,life){
  const lowAreas=Object.entries(life).sort((a,b)=>a[1]-b[1]).slice(0,3).map(x=>x[0]);
  const band=stateBand(pct);
  const anchorName=NAME_BY_STATE[band];
  const anchorAyah=AYAH_BY_STATE[band];
  const anchors=[`ุฐูุฑ ูููู: "ูุง ${anchorName}" 100 ูุฑุฉ`,`ุขูุฉ ุงูููู: ${anchorAyah}`];
  const psych=(band==='low')?CBT_LIBRARY.thought:(band==='mid')?CBT_LIBRARY.gratitude:CBT_LIBRARY.tinyHabit;
  const items=[];
  for(let d=1;d<=14;d++){
    const area=lowAreas[d%lowAreas.length];
    const practice=(d%3===1)?psych:((d%3===2)?CBT_LIBRARY.breath:CBT_LIBRARY.tinyHabit);
    items.push({title:`ุงูููู ${d}: ${area}`,desc:[...anchors,`ุฎุทูุฉ ${area}: 10โ20 ุฏูููุฉ`,practice,"ูุทู ุฎูู ูุดุฎุต ูุงุญุฏ"].join(" โ ")});
  }
  items.push({title:"ูุฑุงุฌุนุฉ ุฎูููุฉ",desc:"ูููู ุงูุชุฒุงูู (0โ10) ูุนุฏูู ุงูุฎุทุฉ."});
  items.push({title:"ุชุซุจูุช ุนุงุฏุฉ",desc:"ุงุฎุชุฑ ุนุงุฏุฉ ูุงุญุฏุฉ ููุงุณุชูุฑุงุฑ 30 ููููุง."});
  return items;
}
function renderRoadmap(){const pct=computeFaithPct();const haw=mapHawkins(pct);const host=byId('roadmapPlan');if(!host)return;host.innerHTML="";roadmapBlocks(pct,haw,lifeScores).forEach(it=>{host.appendChild(el("label",{class:"card anim",html:`<div style="display:flex;gap:10px;align-items:flex-start"><input type="checkbox" style="margin-top:6px"/><div><b>${it.title}</b><div class="small" style="color:var(--muted)">${it.desc}</div></div></div>`}));});}
function downloadPlan(){const html=`<!doctype html><meta charset="utf-8"><title>ุฎุทุฉ ุฒุฏ ุฅููุงูู (14 ููููุง)</title><style>body{font-family:system-ui,"Tajawal";direction:rtl;padding:20px} .task{margin:8px 0;padding:10px;border:1px solid #ddd;border-radius:10px}</style><h2>ุฎุทุฉ ุฒุฏ ุฅููุงูู (14 ููููุง)</h2>${document.getElementById('roadmapPlan').innerHTML}<footer style="margin-top:16px;color:#777;font-size:12px">ยฉ ุดุฑูุฉ ุชูุจูุฉ ููุจุญุซ ูุงูุชุทููุฑ</footer>`;const blob=new Blob([html],{type:"text/html"});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download="iman-roadmap.html";a.click();}

/* Share */
async function shareProgress(){const pct=computeFaithPct();const haw=mapHawkins(pct);const mas=mapMaslow(computeLifeAvg());const text=`ูุชูุฌุชู ูู "ุฒุฏ ุฅููุงูู": ุฅููุงู ${pct}% โ ูุงูููุฒ: ${haw.label} (${haw.code}) โ ูุงุณูู: ${mas}`;if(navigator.share){try{await navigator.share({title:'ุฒุฏ ุฅููุงูู',text});}catch(_){}} else {navigator.clipboard?.writeText(text);alert('ุชู ูุณุฎ ุงููุชุงุฆุฌ ูููุดุงุฑูุฉ.');}}

/* Partner form flow */
function openPartnerForm(){partnerModal.showModal();}
function submitPartnerForm(){
  const name=document.getElementById('pf_name').value.trim();
  const org=document.getElementById('pf_org').value.trim();
  const email=document.getElementById('pf_email').value.trim();
  const phone=document.getElementById('pf_phone').value.trim();
  const type=document.getElementById('pf_type').value.trim();
  const msg=document.getElementById('pf_msg').value.trim();
  if(!name || !email || !type){alert('ูุถูุงู ุฃุฏุฎู ุงูุงุณู ูุงูุจุฑูุฏ ูููุน ุงูุดุฑุงูุฉ.');return;}
  const body = `ูุฑุญุจุงูุ\nุฃุฑุบุจ ุจุงูุงูุถูุงู ูุดุฑูู ูู (ุฒุฏ ุฅููุงูู).\n\nุงูุงุณู: ${name}\nุงูููุธูุฉ: ${org||'-'}\nุงูุจุฑูุฏ: ${email}\nุงููุงุชู: ${phone||'-'}\nููุน ุงูุดุฑุงูุฉ: ${type}\n\nุงูุฑุณุงูุฉ:\n${msg||'-'}\n`;
  const mailto = `mailto:partnerships@example.com?subject=${encodeURIComponent('ุงูุถูุงู ูุดุฑูู - ููุตุฉ ุฒุฏ ุฅููุงูู')}&body=${encodeURIComponent(body)}`;
  window.location.href = mailto;
  uiPing();
  partnerModal.close();
  alert('ุชู ุฅุนุฏุงุฏ ุฑุณุงูุฉ ุงูุจุฑูุฏ. ููููู ุฅุฑุณุงููุง ุงูุขู.');
}

/* Init */
document.getElementById('year').textContent=new Date().getFullYear();
route(); drawRadar(); refreshAll(); randomAyah(); fillHawkinsTable(); setTimeout(()=>{try{fillHawkinsBar();}catch(_){}} ,0);
</script>
</body>
</html>
